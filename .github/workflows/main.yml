name: Deploy Frontend to Backend Prod

on:
  push:
    branches: [main]

jobs:
  Build:
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with: 
          path: frontend
      - name: Install Packages
        run: |
          cd frontend
          npm i
      - name: Build website
        run: |
          cd frontend
          npm run build
        
  Pull-request-into-backend:
    runs-on: self-hosted
    needs: Build
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with: 
          repository: ZGameLogic/Minecraft-Server-Utility-Backend
          ref: development
          path: backend
      - name: Add Build to Backend
        run: echo d | xcopy /j /y /s "frontend\build" "backend\src\resources\static"
      - name: Commit Backend Code
        run: |
          # Configure Git credentials for the push
          git config --global credential.helper "store --file=.git-credentials"
          
          # Generate .git-credentials file with GitHub username and token
          echo "https://zabory:${{ secrets.toke }}@github.com" > .git-credentials
          
          cd backend
          git config --global user.name 'Automation'
          git config --global user.email 'benshabowski@gmail.com'
          git remote set-url origin  https://github.com/Minecraft-Server-Utility-Backend.git 
          git add -A
          git commit -m "Updating backend with new frontend UI automatically"
          ssh-add C:/Users/Ben/.ssh/id_ed
          git push